# 万能的函数包装器

[https://www.cnblogs.com/qicosmos/p/3376241.html](https://www.cnblogs.com/qicosmos/p/3376241.html)

```
template<class Function, class... Args>
inline auto FuncWrapper(Function && f, Args && ... args) -> decltype(f(std::forward<Args>(args)...))
{
//typedef decltype(f(std::forward<Args>(args)...)) ReturnType;
return f(std::forward<Args>(args)...);
//your code; you can use the above typedef.
}
```


该方法在包装类成员函数时需要用到std::bind例如：

```C++
int test(int a,int b)
{
    return a+b;
}

class TestClass
{
public:
    int AddAndPrint(int a, int b, std::string s)
    {
        std::cout << s.c_str() << std::endl;
        return a*b;
    }
};

void testwanneng()
{
    auto ff = [](std::string s){return s;};
    class TestClass2
    {
    public:
        int AddAndPrint(int a, int b, std::string s)
        {
            std::cout << s.c_str() << std::endl;
            return a*b;
        }
    };

    std::cout << Wrap1(test,3,5) << std::endl;
    std::cout << Wrap1(ff,"s") << std::endl;

    TestClass testclass;
    std::cout << Wrap1(std::bind(&TestClass::AddAndPrint,&testclass,std::placeholders::_1,std::placeholders::_2,std::placeholders::_3),3,5,"s") << std::endl;

    TestClass2 testclass2;
    std::cout << Wrap1(std::bind(&TestClass2::AddAndPrint,&testclass2,std::placeholders::_1,std::placeholders::_2,std::placeholders::_3),1,2,"s2") << std::endl;
}
```


既然如此，能不能直接把std::bind的实现搬到wrap函数中?
[https://www.cnblogs.com/qicosmos/p/3379865.html](https://www.cnblogs.com/qicosmos/p/3379865.html)

```C++
template< class F, class... Args, class = typename std::enable_if<!std::is_member_function_pointer<F>::value>::type> 
auto Wrap2(F && f, Args &&...args) -> decltype(f(std::forward<Args>(args)...))
{
    return f(std::forward<Args>(args)...);
}

template<class R, class C, class... DArgs, class P, class... Args>
auto Wrap2(R(C::*f)(DArgs...), P && p, Args &&...args) -> decltype((*p.*f)(std::forward<Args>(args)...))
{
    return (*p.*f)(std::forward<Args>(args)...); 
}

std::cout << Wrap2(test,3,2) << std::endl;
std::cout << Wrap2(ff,"s") << std::endl;
std::cout << Wrap2(&TestClass::AddAndPrint,&testclass,1,2,"wrap2") << std::endl;
std::cout << Wrap2(&TestClass2::AddAndPrint,&testclass2,3,6,"wrap2") << std::endl;

```




